<div class="overlay" (click)="onCancel()" (keyup.escape)="onCancel()" tabindex="0">
    <div class="dialog" (click)="$event.stopPropagation()">
        <div class="dialog-header">
            <h2>Edit Task</h2>
            <button class="icon-btn" (click)="onCancel()" title="Close">X</button>
        </div>
        
        <div class="dialog-body">
            <div class="main-content">
                <form [formGroup]="form" (ngSubmit)="onSave()" class="task-form">
                    <div class="form-group">
                        <label for="title">Title</label>
                        <input id="title" type="text" formControlName="title" placeholder="Task title" />
                        <div class="error" *ngIf="form.get('title')?.invalid && form.get('title')?.touched">
                            <span *ngIf="form.get('title')?.hasError('required')">Title is required</span>
                            <span *ngIf="form.get('title')?.hasError('minlength')">Title must be at least 3 characters</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" formControlName="description" rows="4" placeholder="Detailed description..."></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dueDate">Due Date</label>
                            <input id="dueDate" type="date" formControlName="dueDate" />
                        </div>
                        
                        <div class="form-group">
                            <label for="priority">Priority</label>
                            <select id="priority" formControlName="priority">
                                <option value="LOW">Low</option>
                                <option value="MEDIUM">Medium</option>
                                <option value="HIGH">High</option>
                            </select>
                        </div>

                        <div class="form-group">
                             <label for="status">Status</label>
                             <select id="status" formControlName="status">
                                 <option value="TODO">To Do</option>
                                 <option value="IN_PROGRESS">In Progress</option>
                                 <option value="DONE">Done</option>
                             </select>
                        </div>
                    </div>
                    
                    <div class="actions">
                        <button type="button" class="btn-danger" (click)="onDelete()">Delete Task</button>
                        <div class="right-actions">
                            <button type="button" class="btn-secondary" (click)="onCancel()">Cancel</button>
                            <button type="submit" class="btn-primary" [disabled]="form.invalid || isSubmitting">
                                {{ isSubmitting ? 'Saving...' : 'Save Changes' }}
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <div class="side-panel">
                <h3>Comments</h3>
                <app-comment-list [taskId]="task.id"></app-comment-list>
            </div>
        </div>
    </div>
</div>

<app-task-delete-confirm-dialog
    *ngIf="isDeleteConfirmOpen()"
    [task]="task"
    (confirm)="onDeleteConfirm()"
    (cancel)="onDeleteCancel()"
>
</app-task-delete-confirm-dialog>